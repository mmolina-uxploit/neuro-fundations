# Impossible States

### Concepto: Diseño de Tipos Correctos por Construcción

El diseño orientado a estados imposibles consiste en estructurar el sistema de tipos de forma que las combinaciones de datos inválidas no puedan compilarse, moviendo la detección de errores del **Runtime** al **Compile-time**.

### Análisis de Validación

| Enfoque | Implementación Débil | Implementación Robusta |
| :--- | :--- | :--- |
| **Consistencia** | Múltiples variables independientes | Estructura única consolidada |
| **Validación** | Verificaciones manuales (`if/else`) | Restricciones de tipo (Invariantes) |
| **Ambigüedad** | Valores mágicos o tipos primitivos | Tipos específicos del dominio |
| **Seguridad** | Riesgo de estados contradictorios | Estados inválidos irrepresentables |



### Observaciones de Diseño

* **Eliminación de la Contradicción:** Un error común es usar múltiples `Optionals` para modelar un proceso. Por ejemplo, tener `data` y `error` como opcionales permite el estado imposible de "ambos presentes" o "ambos nulos". Un `Enum` con valores asociados elimina esta ambigüedad.
* **Invariantes en Inicialización:** Al usar constructores que validan los datos (failable initializers), garantizamos que si una instancia existe, es válida por definición.
* **Tipado Fuerte vs. Primitivos:** Evitar el "Primitive Obsession" (usar `String` para todo). Crear tipos como `Email` o `ID` asegura que no se operen datos semánticamente distintos aunque compartan representación técnica.

### Decisión Arquitectónica

1. **Garantía de Integridad:**
    * Un `User` siempre debe poseer sus atributos críticos (`id`, `name`). Si falta uno, la instancia no debe poder crearse.
    * Los estados de un proceso (ej. `DownloadStatus`) deben limitarse estrictamente a los casos declarados en un `Enum`.

2. **Supresión de Ambigüedad:**
    * No utilizar `Optional` para representar algo que es obligatorio en un contexto específico.
    * Reemplazar valores mágicos (ej. `-1` para errores o `""` para vacío) por tipos descriptivos que el compilador pueda validar.

---
